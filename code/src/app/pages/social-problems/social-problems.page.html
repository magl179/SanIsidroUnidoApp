<app-header-back title="Problemas Sociales" [search]="true" [filter]="true" [report]="true"
    (optionSelected)="getOptionSelected($event)"></app-header-back>
<ion-content padding style="position: relative;">
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
        <ion-refresher-content pullingIcon="arrow-dropdown" refreshingSpinner="circles"
            refreshingText="Cargando Publicaciones...">
        </ion-refresher-content>
    </ion-refresher>
    <p> Num Problemas Sociales {{socialProblemsFilter.length}}</p>
    <!-- Mensaje no cargaron los datos desde la Api -->
    <div class="flex-column-center message-fail-load"
        *ngIf="socialProblemsLoaded && socialProblemsList.length === 0">
        <p>No se pudieron cargar los problemas sociales reportados</p>
        <ion-button (click)="loadSocialProblems(null,true)">Toca para reintentar</ion-button>
    </div>
    <!-- Animacion Tarjeta hasta tener los Datos Cargados -->
    <div *ngIf="!socialProblemsLoaded">
        <ion-card *ngFor="let items of [1,1,1,1]"
            class="social-problem animated flash slow infinite">
            <ion-card-header class="post-header">
                <ion-card-title class="post-title">
                    <ion-skeleton-text width="60%"></ion-skeleton-text>
                </ion-card-title>
            </ion-card-header>
            <ion-card-content class="post-content">
                <ion-skeleton-text width="70%"></ion-skeleton-text>
                <ion-skeleton-text width="70%"></ion-skeleton-text>
            </ion-card-content>
            <div class="social">
                <div class="social-options">
                    <div class="social-button" style="width: 50%;height: 30px;">
                        <ion-skeleton-text width="55%"></ion-skeleton-text>
                    </div>
                </div>
                <div class="social-options">
                    <div class="social-button" style="width: 50%;height: 30px;">
                        <ion-skeleton-text width="55%"></ion-skeleton-text>
                    </div>
                </div>
            </div>
        </ion-card>
    </div>
    <!-- Tarjeta con Datos Cargados -->
    <div *ngIf="socialProblemsLoaded  && socialProblemsList.length > 0">
        <ion-card class="social-problem" *ngFor="let socialProblem of socialProblemsFilter">
            <div (click)="postDetail(socialProblem.id)">
                <ion-card-header class="post-header">
                    <ion-card-title class="post-title"> {{socialProblem.title}}
                    </ion-card-title>
                </ion-card-header>
                <ion-card-content class="post-content">
                    <p class="post-description">
                        {{socialProblem.description}}
                    </p>
                </ion-card-content>
            </div>
            <div class="social">
                <div class="social-content">
                    <span *ngIf="socialProblem.postLiked">A ti y {{socialProblem.details.length}}
                        persona(s) m√°s les gusta</span>
                    <span *ngIf="!socialProblem.postLiked">
                        A {{socialProblem.details.length}}
                        {{(socialProblem.details.length === 1) ? 'persona le gusta' : 'personas les gusta'}}
                    </span>
                </div>
                <div class="social-options"
                    (click)="toggleLike(socialProblem.postLiked, socialProblem.id)">
                    <div class="social-button" [class.active]="socialProblem.postLiked">
                        <ion-icon class="like" name="heart"></ion-icon>
                        <span>Me gusta</span>
                    </div>
                    <div class="social-button" (click)="sharePost(socialProblem)">
                        <ion-icon class="share" name="share"></ion-icon>
                        <span>Compartir</span>
                    </div>
                </div>
            </div>
        </ion-card>
    </div>
    <!--Opciones del FabButton -->
    <!-- <ion-fab vertical="bottom" horizontal="center" slot="fixed">
        <ion-fab-button color="primary" size="small">
            <ion-icon name="ios-keypad"></ion-icon>
        </ion-fab-button>
        <ion-fab-list side="top">
            <ion-fab-button color="secondary" (click)="showModalSearchSocialProblems()">
                <ion-icon name="search"></ion-icon>
            </ion-fab-button>
        </ion-fab-list>
        <ion-fab-list side="start">
            <ion-fab-button color="danger" (click)="showModalFilterSocialProblems()">
                <ion-icon name="ios-funnel"></ion-icon>
            </ion-fab-button>
        </ion-fab-list>
        <ion-fab-list side="end" *appHasRole="['morador']">
            <ion-fab-button color="tertiary" (click)="reportSocialProblem()">
                <ion-icon name="send"></ion-icon>
            </ion-fab-button>
        </ion-fab-list>
    </ion-fab> -->
    <!-- Scroll Infinito -->
    <ion-infinite-scroll threshold="150px" (ionInfinite)="getInfiniteScrollData($event)">
        <ion-infinite-scroll-content loadingSpinner="crescent"
            loadingText="Cargando Publicaciones...">
        </ion-infinite-scroll-content>
    </ion-infinite-scroll>
</ion-content>
