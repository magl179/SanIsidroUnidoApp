<app-header-back title="Reportar Emergencia"></app-header-back>

<ion-content padding>
    <mat-vertical-stepper linear="true" #stepper_emergencies>
        <!-- Paso 1 -->
        <mat-step>
            <ng-template matStepLabel>Rellena los datos de tu reporte</ng-template>
            <form [formGroup]="emergencyForm">
                <div class="item-form full">
                    <ion-item class="input_item" lines="none">
                        <ion-label class="label-padding" position="stacked">Titulo</ion-label>
                        <ion-input placeholder="Ingresa el título de tu reporte"
                            class="input-beatiful" formControlName="title" type="email"></ion-input>
                    </ion-item>
                </div>
                <div class="form-errors padding-lateral">
                    <p class="form-error"
                        *ngIf="emergencyForm.get('title').hasError('required') && emergencyForm.get('title').touched">
                        {{errorMessages.title.required.message}}
                    </p>
                </div>
                <div class="item-form full">
                    <ion-item class="input_item" lines="none">
                        <ion-label class="label-padding" position="stacked">Descripción</ion-label>
                        <ion-textarea class="input-beatiful text-area"
                            placeholder="Ingresa la descripción de tu reporte"
                            formControlName="description" auto-grow="true"></ion-textarea>
                    </ion-item>
                </div>
                <div class="form-errors padding-lateral">
                    <p class="form-error"
                        *ngIf="emergencyForm.get('description').hasError('required') && emergencyForm.get('description').touched">
                        {{errorMessages.description.required.message}}
                    </p>
                </div>
                <div padding>
                    <ion-button [disabled]="!emergencyForm.valid" color="primary" type="submit" expand="block"
                    (click)="stepper_emergencies.next()">Siguiente
                    </ion-button>
                </div>
            </form>
        </mat-step>
        <!-- Paso 2 -->
        <mat-step>
            <ng-template matStepLabel>Carga hasta 2 fotos para tu reporte</ng-template>4
            <single-map id="emergencyReportMap" [zoomMap]="17" [enableGesture]="false"
                (returnCoordinateChoosen)="updateMapCoordinate($event)">
            </single-map>

            <p *ngIf="emergencyPostCoordinate.address" class="name-ubication-pt">Tu
                Dirección es:
                {{emergencyPostCoordinate.address}}</p>
            <form class="form-ubication" [formGroup]="ubicationForm">
                <div class="item-form full">
                    <ion-item class="input_item padding-lateral-none" lines="none">
                        <ion-label class="label-padding" position="stacked">Descripción de la
                            Ubicación</ion-label>
                        <ion-textarea
                            placeholder="Ingresa una descripción más detallada de la ubicación de tu reporte"
                            class="input-beatiful text-area" formControlName="description_ubication"
                            auto-grow="true"></ion-textarea>
                    </ion-item>
                </div>
                <div class="form-errors padding-lateral">
                    <p class="form-error"
                        *ngIf="ubicationForm.get('description_ubication').hasError('required') && ubicationForm.get('description_ubication').touched">
                        {{errorMessages.description.required.message}}
                    </p>
                </div>
            </form>
            <div>
                <ion-button color="primary" [disabled]="!ubicationForm.valid" expand="full"
                    type="submit" (click)="stepper_emergencies.next()">Siguiente
                </ion-button>
            </div>
        </mat-step>
        <!-- Paso 3 -->
        <mat-step>
            <ng-template matStepLabel>Selecciona la ubicación del reporte</ng-template>
            <ion-grid *ngIf="emergencyImages.length > 0">
                <ion-row>
                    <ion-col size="6" *ngFor="let image of emergencyImages; let i = index;">
                        <ion-item-sliding>
                            <ion-item lines="none">
                                <ion-card>
                                    <img [src]="image | imageSanitizer">
                                </ion-card>
                            </ion-item>
                            <ion-item-options side="end">
                                <ion-item-option (click)="deleteImage(i)" color="danger"
                                    expandable="true">
                                    <ion-icon slot="icon-only" name="trash"></ion-icon>
                                </ion-item-option>
                            </ion-item-options>
                        </ion-item-sliding>
                    </ion-col>
                </ion-row>
            </ion-grid>
            <app-upload-image [uploadedImages]="emergencyImages" [maxImages]="2"
                (returnUploadedImages)="getUploadedImages($event)"></app-upload-image>
            <div padding>
                <ion-button color="primary" type="submit" expand="block" (click)="stepper_emergencies.next()">
                    Siguiente
                </ion-button>
            </div>
        </mat-step>
        <!-- Paso Final -->
        <mat-step>
            <ng-template matStepLabel>Listo, ahora ya puedes enviar tu reporte</ng-template>
            <h3>{{emergencyForm.get('title').value || 'Ingresa un Titulo'}}</h3>
            <p class="preview-text">{{emergencyForm.get('description').value || 'Ingresa una descripción'}}</p>
            <!-- <p *ngIf="emergencyPostCoordinate.address">Dirección de la Emergencia</p> -->
            <p class="preview-text" *ngIf="emergencyPostCoordinate.address">{{emergencyPostCoordinate.address}}</p>
            <div class="section-img-thumb" *ngIf="emergencyImages.length > 0">
                <ion-thumbnail *ngFor="let image of emergencyImages">
                    <img [src]="image | imageSanitizer">
                </ion-thumbnail>
            </div>
            <!-- <p *ngIf="emergencyImages.length === 0">No hay ninguna imagen para enviar</p> -->
            <div>
                <ion-button expand="full" (click)="sendEmergencyReport()">Reportar</ion-button>
            </div>
        </mat-step>
    </mat-vertical-stepper>
</ion-content>
