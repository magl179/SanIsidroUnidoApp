<app-header title="Mi Perfil"></app-header>

<ion-content padding>
    <div class="container-profile">
        <!-- AVATAR USUARIO -->
        <div class="img-profile ion-padding-top">
            <div class="item_img" *ngIf="AuthUser">
                <img [src]="getAvatar(AuthUser.avatar)" fallimg="user_avatar" />
                <div class="upload_image" (click)="showChangeUserImageProfileModal()">
                    <ion-icon name="camera"></ion-icon>
                </div>
            </div>
        </div>
        <!-- INFORMACION DEL USUARIO -->
        <div class="ion-text-center" *ngIf="AuthUser">
            <h3 class="user_data">
                <!-- <ion-icon name="person" class="icon"></ion-icon> -->
                <span>{{AuthUser.firstname || 'Sin Nombre'}}
                    {{AuthUser.lastname || 'Sin Apellidos'}}</span>
            </h3>
            <p class="user_data">
                <!-- <ion-icon name="mail" class="icon"></ion-icon> -->
                <span>{{AuthUser.email || 'sin email'}}</span>
            </p>
            <p class="user_data">
                <!-- <ion-icon name="briefcase" class="icon"></ion-icon> -->
                <span class="ion-text-capitalize">
                    {{(AuthUser && AuthUser.roles && AuthUser.roles.length > 0) ? AuthUser.roles[0].name : 'No tienes un rol registrado'}}
                </span>
            </p>
            <p class="user_data" *ngIf="AuthUser.number_phone">
                <ion-icon name="call" class="icon"></ion-icon>
                <span>{{AuthUser.number_phone || 'sin telefono'}}</span>
            </p>
        </div>
        <!-- OPCIONES EDITAR MENU -->
        <ion-grid>
            <ion-row>
                <ion-col class="user_profile_options">
                    <div class="icon_option" (click)="showEditProfileModal()">
                        <ion-icon name="create"></ion-icon>
                    </div>
                    <p class="title_option">Editar Perfil</p>
                </ion-col>
                <ion-col class="user_profile_options">
                    <div class="icon_option" (click)="showChangePassModal()">
                        <ion-icon name="key"></ion-icon>
                    </div>
                    <p class="title_option">Cambiar Contraseña</p>
                </ion-col>
                <!-- <ng-container *ngIf="AuthUser && AuthUser.user"> -->
                    <ion-col class="user_profile_options" *ngIf="AuthUser && !AuthUser.basic_service_image">
                        <div class="icon_option" (click)="showRequestMembershipModal()">
                            <ion-icon name="document"></ion-icon>
                        </div>
                        <p class="title_option">Solicitar Afiliación</p>
                    </ion-col>
                <!-- </ng-container> -->
                <ion-col class="user_profile_options" *appHasDevice="UserDevices">
                    <div class="icon_option" (click)="addDeviceToUser()">
                        <ion-icon name="notifications"></ion-icon>
                    </div>
                    <p class="title_option">Asociar Mi Dispositivo</p>
                </ion-col>
            </ion-row>
        </ion-grid>
        <!-- REDES SOCIALES ASOCIADAS -->
        <div class="list-items-container animated flash slow infinite"
            *ngIf="!userSocialProfilesLoaded">
            <p class="title">
                <ion-skeleton-text width="60%"></ion-skeleton-text>
            </p>
            <div class="list-items">
                <div class="list-item" *ngFor="let i of [1,1,1]; let i = index">
                    <div class="item-left">
                        <ion-thumbnail slot="start" class="icon">
                            <ion-skeleton-text animated style="border-radius: 50%;"></ion-skeleton-text>
                        </ion-thumbnail>
                        <span class="label">
                            <ion-skeleton-text width="40%"></ion-skeleton-text>
                        </span>
                    </div>
                    <div class="item-right">
                        <ion-button color="light" class="ion-text-capitalize">
                            <ion-skeleton-text width="60%"></ion-skeleton-text>
                        </ion-button>
                    </div>
                </div>
            </div>
        </div>

        <div class="list-items-container"
            *ngIf="UserSocialProfiles && UserSocialProfiles.length > 0">
            <p class="title">Redes Sociales Asociadas</p>
            <div class="list-items">
                <div class="list-item"
                    *ngFor="let user_social_profile of UserSocialProfiles; let i = index">
                    <div class="item-left">
                        <img class="icon" src="/assets/img/svg/google.svg"
                            *ngIf="(user_social_profile.provider | lowercase) === 'google'">
                        <img class="icon" src="/assets/img/svg/facebook.svg"
                            *ngIf="(user_social_profile.provider | lowercase) === 'facebook'">
                        <span class="label">Stalin Maza</span>
                    </div>
                    <div class="item-right">
                        <ion-button *ngIf="AuthUser.password !== null" color="light"
                            class="ion-text-capitalize"
                            (click)="removeSocialProfileToUser(user_social_profile.id)">Desconectar
                        </ion-button>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex-column-center message-fail-load"
            *ngIf="userSocialProfilesLoaded && UserSocialProfiles.length === 0">
            <p>No se pudieron cargar tus redes sociales asociadas</p>
            <ion-button (click)="getUserSocialProfiles()">Toca para reintentar</ion-button>
        </div>
        <!-- DISPOSITIVOS ASOCIADOS -->
        <div class="list-items-container animated flash slow infinite"
            *ngIf="!userSocialProfilesLoaded">
            <p class="title">
                <ion-skeleton-text width="60%"></ion-skeleton-text>
            </p>
            <div class="list-items">
                <div class="list-item" *ngFor="let i of [1,1]; let i = index">
                    <div class="item-left">
                        <img class="icon" src="/assets/img/svg/smartphone.svg">
                        <div class="label">
                            <p>
                                <ion-skeleton-text width="40%"></ion-skeleton-text>
                            </p>
                        </div>
                    </div>
                    <div class="item-right">
                        <ion-button color="light" class="ion-text-capitalize">
                            <ion-skeleton-text width="30%"></ion-skeleton-text>
                        </ion-button>
                    </div>
                </div>
            </div>
        </div>

        <div class="list-items-container" *ngIf="UserDevices && UserDevices.length > 0">
            <p class="title">Dispositivos asociados</p>
            <div class="list-items">
                <div class="list-item" *ngFor="let user_device of UserDevices; let i = index">
                    <div class="item-left">
                        <img class="icon" src="/assets/img/svg/smartphone.svg">
                        <div class="label">
                            <p>{{user_device.phone_model}}</p>
                        </div>
                    </div>
                    <div class="item-right">
                        <ion-button *ngIf="user_device.phone_id !== CurrentUserDevice.phone_id"
                            color="light" class="ion-text-capitalize"
                            (click)="removeUserDevice(user_device.id)">Desconectar</ion-button>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex-column-center message-fail-load"
            *ngIf="userDevicesLoaded && UserDevices.length === 0">
            <p>No se pudieron cargar tus dispositivos asociados</p>
            <ion-button (click)="getUserDevices()">Toca para reintentar</ion-button>
        </div>
        <!-- INFO DISPOSITIVO -->
        <div *ngIf="CurrentUserDevice" style="padding-left: 1rem;">
            <p>DeviceUser: {{CurrentUserDevice.phone_id}}</p>
            <p>DeviceUser: {{CurrentUserDevice.phone_model}}</p>
        </div>
        <div *ngIf="!CurrentUserDevice" style="padding-left: 1rem;">
            No se pudo obtener info device user
        </div>
    </div>
</ion-content>
