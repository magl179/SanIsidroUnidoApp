<app-header title="Reportar Problema Social"></app-header>

<ion-content padding>
    <app-stepbar [progressSteps]="socialProblemFormStage" [currentStep]="currentStep"
        (returnCurrentStep)="updateCurrentStep($event)"></app-stepbar>
    <section *ngIf="currentStep === 3
    ">
    <form [formGroup]="socialProblemForm">
            <ion-item>
                <ion-label position="floating">Titulo</ion-label>
                <ion-input formControlName="title" type="email"></ion-input>
            </ion-item>
            <div class="form-errors">
                <p class="form-error"
                    *ngIf="socialProblemForm.get('title').hasError('required') && socialProblemForm.get('title').touched">
                    {{errorMessages.title.required.message}}
                </p>
            </div>
            <ion-item>
                <ion-label position="floating">Descripcion</ion-label>
                <ion-textarea formControlName="description" auto-grow="true"></ion-textarea>
            </ion-item>
            <div class="form-errors">
                <p class="form-error"
                    *ngIf="socialProblemForm.get('description').hasError('required') && socialProblemForm.get('description').touched">
                    {{errorMessages.description.required.message}}
                </p>
            </div>
            <div padding>
                <ion-button color="primary" type="submit" expand="block" (click)="validatePhase3()">Siguiente
                </ion-button>
            </div>
        </form>
    </section>
    <section *ngIf="currentStep === 1
    ">
        <p class="ion-text-center">Puedes agregar hasta 2 imagene</p>
        <app-upload-image [maxImages]="2" (retornarImagenesSubidas)="getUploadedImages()"></app-upload-image>
        <div padding>
            <ion-button color="primary" type="submit" expand="block" (click)="validatePhase1()">Siguiente
            </ion-button>
        </div>
    </section>
    <section *ngIf="currentStep === 2
    ">
        <p class="ion-text-center">Escoge la ubicación donde se genero la emergencia</p>
        <single-map idMap="socialProblemReportMap" [zoomMap]="14" [mapPoints]="socialProblemCoordinate"
            (returnCoordinateChoosen)="updateMapCoordinate($event)"></single-map>
        <p>Latitud PAGE EC: Market {{socialProblemCoordinate.latitude}}</p>
        <p>Longitud PAGE EC: Market {{socialProblemCoordinate.longitude}}</p>
        <p *ngIf="socialProblemCoordinate.address">Tu Dirección es: {{socialProblemCoordinate.address}}</p>
        <div>
            <ion-button color="primary" expand="full" type="submit" (click)="validatePhase2()">Siguiente
            </ion-button>
        </div>
    </section>
    <section *ngIf="currentStep === 4
    ">
        <h2>{{socialProblemForm.get('title').value || 'Ingresa un Titulo'}}</h2>
        <p>{{socialProblemForm.get('title').value || 'Ingresa una descripción'}}</p>
        <p *ngIf="socialProblemCoordinate.address">Dirección de la Emergencia</p>
        <p *ngIf="socialProblemCoordinate.address">{{socialProblemCoordinate.address}}</p>
        <p *ngIf="!socialProblemCoordinate.address">Por favor escoge una ubicación</p>
        <div class="section-img-thumb" *ngIf="socialProblemImages.length > 0">
            <ion-thumbnail *ngFor="let image of socialProblemImages">
                <img src="https://gravatar.com/avatar/dba6bae8c566f9d4041fb9cd9ada7741?d=identicon&f=y">
            </ion-thumbnail>
        </div>
        <p *ngIf="socialProblemImages.length === 0">No hay imagenes en este post</p>
        <div>
            <ion-button expand="full" (click)="sendSocialProblem()">Reportar</ion-button>
        </div>
    </section>
</ion-content>