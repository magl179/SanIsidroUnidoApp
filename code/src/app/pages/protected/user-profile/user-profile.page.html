<app-header title="Mi Perfil"></app-header>

<ion-content padding>
    <app-network-banner *ngIf="!appNetworkConnection" networkConnection="appNetworkConnection"></app-network-banner>
    <div class="container-profile" *ngIf="appNetworkConnection">
        <div class="img-profile ion-padding-top">
            <div class="item_img" *ngIf="AuthUser">
                <img [src]="(AuthUser.avatar) ? getImageURL(AuthUser.avatar) : 'assets/img/default/img_avatar.png'" alt="User Profile Image" />
                <div class="upload_image" (click)="showChangeUserImageProfileModal()">
                    <ion-icon name="camera"></ion-icon>
                </div>
            </div>
        </div>
        <div class="ion-text-center" *ngIf="AuthUser">
            <h3 class="user_data">
                <ion-icon name="person" class="icon"></ion-icon>
                <span>{{AuthUser.firstname || 'Sin Nombre'}} {{AuthUser.lastname || 'Sin Apellidos'}}</span>
            </h3>
            <p class="user_data" >
                <ion-icon name="mail" class="icon"></ion-icon>
                <span>{{AuthUser.email || 'sin email'}}</span>
            </p>
            <p class="user_data">
                <ion-icon name="briefcase" class="icon"></ion-icon>
                <span class="ion-text-capitalize">{{ authUserRol || 'No tienes un rol registrado'}}</span>
            </p>
            <p class="user_data" *ngIf="AuthUser.number_phone">
                <ion-icon name="call" class="icon"></ion-icon>
                <span>{{AuthUser.number_phone || 'sin telefono'}}</span>
            </p>
        </div>
        <ion-grid>
            <ion-row>
                <ion-col class="user_profile_options">
                    <div class="icon_option" (click)="showEditProfileModal()">
                        <ion-icon name="create"></ion-icon>
                    </div>
                    <p class="title_option">Editar Perfil</p>
                </ion-col>
                <ion-col class="user_profile_options">
                    <div class="icon_option" (click)="showChangePassModal()">
                        <ion-icon name="key"></ion-icon>
                    </div>
                    <p class="title_option">Cambiar Contraseña</p>
                </ion-col>
                <ion-col class="user_profile_options" *appHasRole="['morador_invitado']">
                    <div class="icon_option" (click)="showRequestMembershipModal()">
                        <ion-icon name="document"></ion-icon>
                    </div>
                    <p class="title_option">Solicitar Afiliación</p>
                </ion-col>
                <ion-col class="user_profile_options" *appHasDevice>
                    <div class="icon_option" (click)="addDeviceToUser()">
                        <ion-icon name="notifications"></ion-icon>
                    </div>
                    <p class="title_option">Asociar Mi Dispositivo</p>
                </ion-col>
            </ion-row>
        </ion-grid>

        <div class="list-items-container" *ngIf="AuthUser && AuthUser.social_profiles && AuthUser.social_profiles.length > 0">
            <p class="title">Redes Sociales Asociadas</p>
            <div class="list-items">
                <div class="list-item" *ngFor="let user_social_profile of AuthUser.social_profiles; let i = index">
                    <div class="item-left">
                        <img class="icon" src="/assets/img/svg/google.svg" *ngIf="(user_social_profile.provider | lowercase) === 'google'">
                        <img class="icon" src="/assets/img/svg/facebook.svg" *ngIf="(user_social_profile.provider | lowercase) === 'facebook'">
                        <span class="label">Stalin Maza</span>
                    </div>
                    <div class="item-right">
                            <ion-button *ngIf="AuthUser.password !== null" color="light" class="ion-text-capitalize" (click)="removeSocialProfileToUser(user_social_profile.id)">Desconectar</ion-button>
                    </div>
                </div>
            </div>
        </div>

        <div class="list-items-container" *ngIf="AuthUser && AuthUser.devices && AuthUser.devices.length > 0">
                <p class="title">Dispositivos asociados</p>
                <div  class="list-items">
                    <div class="list-item" *ngFor="let user_device of AuthUser.devices; let i = index">
                        <div class="item-left">
                            <img class="icon" src="/assets/img/svg/smartphone.svg">
                            <div class="label">
                                <p>{{user_device.phone_model}}</p>
                            </div>

                        </div>
                        <div class="item-right">
                            <ion-button *ngIf="user_device.phone_id !== DeviceUser.phone_id" color="light" class="ion-text-capitalize" (click)="removeDevicetoUser(user_device.id)">Desconectar</ion-button>
                        </div>
                    </div>
                </div>
            </div>
        
        <div *ngIf="DeviceUser" style="padding-left: 1rem;">
            <p>DeviceUser: {{DeviceUser.phone_id}}</p>
            <p>DeviceUser: {{DeviceUser.phone_model}}</p>
            <p>DeviceUser: {{DeviceUser.phone_platform}}</p>
        </div>
        <div *ngIf="!DeviceUser"  style="padding-left: 1rem;">
            No se pudo obtener info device user
        </div>
    </div>
</ion-content>